<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Tutor Chat â€” Remote Education Tutor</title>
<link rel="stylesheet" href="css/styles.css">
<style>
  body { overflow: hidden; }
  
  .chat-layout {
    display: flex;
    gap: 0;
    height: calc(100vh - 64px);
    margin-top: 64px;
    margin-left: var(--sidebar-w);
  }
  
  /* History sidebar */
  .chat-history {
    width: 260px;
    flex-shrink: 0;
    border-right: 1px solid var(--border);
    background: var(--bg-sidebar);
    backdrop-filter: blur(20px);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  .chat-history-header {
    padding: 16px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .chat-history-list {
    flex: 1;
    overflow-y: auto;
    padding: 8px;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .history-item {
    padding: 10px 12px;
    border-radius: 10px;
    cursor: pointer;
    transition: var(--transition);
    border: 1px solid transparent;
  }
  .history-item:hover { background: rgba(79,70,229,0.06); border-color: var(--border); }
  .history-item.active { background: rgba(79,70,229,0.1); border-color: var(--primary-light); }
  .history-title { font-size: 0.82rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .history-sub { font-size: 0.7rem; color: var(--text-light); margin-top: 2px; }
  .history-icon { font-size: 0.72rem; margin-right: 4px; }
  
  /* Chat main */
  .chat-main {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    min-width: 0;
  }
  
  .chat-header {
    padding: 14px 20px;
    border-bottom: 1px solid var(--border);
    background: var(--bg-card);
    backdrop-filter: blur(16px);
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .ai-avatar {
    width: 40px; height: 40px;
    background: linear-gradient(135deg, var(--primary), var(--accent2));
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    box-shadow: 0 4px 14px rgba(79,70,229,0.3);
    position: relative;
  }
  .online-dot {
    position: absolute;
    bottom: -2px; right: -2px;
    width: 10px; height: 10px;
    background: var(--success);
    border-radius: 50%;
    border: 2px solid var(--bg-card);
  }
  
  .messages-area {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  
  .message-row {
    display: flex;
    gap: 10px;
    align-items: flex-end;
  }
  .message-row.user { flex-direction: row-reverse; }
  .msg-avatar {
    width: 30px; height: 30px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: 700;
    flex-shrink: 0;
  }
  .msg-timestamp {
    font-size: 0.68rem;
    color: var(--text-light);
    margin-top: 4px;
    padding: 0 4px;
  }
  .message-row.user .msg-timestamp { text-align: right; }
  
  .suggested-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding: 0 20px 12px;
  }
  .chip {
    padding: 6px 14px;
    border-radius: 99px;
    border: 1.5px solid var(--border);
    font-size: 0.78rem;
    cursor: pointer;
    color: var(--text-muted);
    background: var(--bg-card);
    transition: var(--transition);
    white-space: nowrap;
  }
  .chip:hover {
    border-color: var(--primary);
    color: var(--primary);
    background: rgba(79,70,229,0.05);
  }
  
  .chat-input-area {
    padding: 12px 16px;
    border-top: 1px solid var(--border);
    background: var(--bg-card);
    backdrop-filter: blur(16px);
  }
  .chat-input-box {
    display: flex;
    align-items: flex-end;
    gap: 10px;
    background: rgba(79,70,229,0.04);
    border: 1.5px solid var(--border);
    border-radius: 14px;
    padding: 10px 12px;
    transition: var(--transition);
  }
  .chat-input-box:focus-within {
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(79,70,229,0.1);
  }
  #chat-textarea {
    flex: 1;
    border: none;
    outline: none;
    background: transparent;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.88rem;
    color: var(--text);
    resize: none;
    max-height: 120px;
    line-height: 1.5;
  }
  #chat-textarea::placeholder { color: var(--text-light); }
  
  .send-btn {
    width: 36px; height: 36px;
    border-radius: 10px;
    background: linear-gradient(135deg, var(--primary), var(--accent2));
    border: none;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    flex-shrink: 0;
    transition: var(--transition);
    box-shadow: 0 4px 12px rgba(79,70,229,0.3);
  }
  .send-btn:hover { transform: scale(1.05); box-shadow: 0 6px 18px rgba(79,70,229,0.4); }
  .send-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
  
  .subject-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    border-radius: 99px;
    font-size: 0.72rem;
    font-weight: 600;
    background: rgba(79,70,229,0.1);
    color: var(--primary);
    cursor: pointer;
    border: none;
    transition: var(--transition);
  }
  .subject-pill:hover { background: rgba(79,70,229,0.18); }
  
  .typing-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text-muted);
    font-size: 0.78rem;
    padding: 2px 0;
  }
  
  @media(max-width:768px) {
    .chat-layout { margin-left: 0; }
    .chat-history { display: none; }
    .chat-history.open { display: flex; position:fixed;left:0;top:64px;bottom:0;z-index:150;width:260px; }
  }
</style>
</head>
<body>

<script src="js/layout.js"></script>
<script>renderLayout('AI Tutor Chat', 'chat.html');</script>

<div class="chat-layout">
  <!-- Chat History Sidebar -->
  <div class="chat-history" id="chat-history">
    <div class="chat-history-header">
      <span style="font-size:0.88rem;font-weight:700">Conversations</span>
      <button class="btn btn-primary btn-sm" onclick="newChat()">+ New</button>
    </div>
    <div class="chat-history-list">
      <div class="history-item active">
        <div class="history-title"><span class="history-icon">âš›ï¸</span>Newton's Laws of Motion</div>
        <div class="history-sub">Physics Â· Today, 10:30 AM</div>
      </div>
      <div class="history-item" onclick="loadChat(this,'Organic Chemistry Basics')">
        <div class="history-title"><span class="history-icon">ğŸ§ª</span>Organic Chemistry Basics</div>
        <div class="history-sub">Chemistry Â· Yesterday</div>
      </div>
      <div class="history-item" onclick="loadChat(this,'Quadratic Equations')">
        <div class="history-title"><span class="history-icon">ğŸ“</span>Quadratic Equations</div>
        <div class="history-sub">Math Â· 2 days ago</div>
      </div>
      <div class="history-item" onclick="loadChat(this,'World War II Summary')">
        <div class="history-title"><span class="history-icon">ğŸŒ</span>World War II Summary</div>
        <div class="history-sub">History Â· 3 days ago</div>
      </div>
      <div class="history-item" onclick="loadChat(this,'Photosynthesis Process')">
        <div class="history-title"><span class="history-icon">ğŸŒ±</span>Photosynthesis Process</div>
        <div class="history-sub">Biology Â· 4 days ago</div>
      </div>
      <div class="history-item" onclick="loadChat(this,'Trigonometry Formulas')">
        <div class="history-title"><span class="history-icon">ğŸ“</span>Trigonometry Formulas</div>
        <div class="history-sub">Math Â· Last week</div>
      </div>
      <div class="history-item" onclick="loadChat(this,'Indian Independence Movement')">
        <div class="history-title"><span class="history-icon">ğŸ‡®ğŸ‡³</span>Indian Independence Movement</div>
        <div class="history-sub">History Â· Last week</div>
      </div>
    </div>
  </div>
  
  <!-- Main Chat -->
  <div class="chat-main">
    <div class="chat-header">
      <div class="ai-avatar">
        ğŸ¤–
        <div class="online-dot"></div>
      </div>
      <div style="flex:1">
        <div style="font-size:0.92rem;font-weight:700">AI Tutor â€” Vidya</div>
        <div style="font-size:0.72rem;color:var(--success)">â— Online Â· Powered by context pruning</div>
      </div>
      <div style="display:flex;gap:8px">
        <button class="subject-pill" onclick="showToast('Switched to Physics context','info')">âš›ï¸ Physics</button>
        <button class="icon-btn" onclick="showToast('Chat cleared','info')" data-tooltip="Clear chat">ğŸ—‘ï¸</button>
        <button class="icon-btn" onclick="showToast('Chat exported','success')" data-tooltip="Export">ğŸ“¤</button>
      </div>
    </div>
    
    <div class="messages-area" id="messages-area">
      
      <!-- AI welcome -->
      <div class="message-row">
        <div class="msg-avatar" style="background:linear-gradient(135deg,var(--primary),var(--accent2));color:white">AI</div>
        <div>
          <div class="chat-bubble ai">
            ğŸ‘‹ Namaste! I'm <strong>Vidya</strong>, your AI tutor. I've loaded your <strong>Class 10 Physics textbook</strong>. I'm here to help you understand any topic clearly and simply. What would you like to learn today?
          </div>
          <div class="msg-timestamp">10:30 AM</div>
        </div>
      </div>
      
      <!-- User -->
      <div class="message-row user">
        <div class="msg-avatar" style="background:linear-gradient(135deg,#34d399,#06b6d4);color:white">AS</div>
        <div>
          <div class="chat-bubble user">Can you explain Newton's First Law of Motion in simple language?</div>
          <div class="msg-timestamp">10:31 AM</div>
        </div>
      </div>
      
      <!-- AI response -->
      <div class="message-row">
        <div class="msg-avatar" style="background:linear-gradient(135deg,var(--primary),var(--accent2));color:white">AI</div>
        <div>
          <div class="chat-bubble ai">
            <p>Great question! ğŸŒŸ Newton's First Law is also called the <strong>Law of Inertia</strong>.</p>
            <br>
            <p><strong>Simple explanation:</strong></p>
            <p>Think of a ball lying on the ground. It will stay there <em>forever</em> unless you kick it. And once you kick it, it would keep moving forever if there was no friction.</p>
            <br>
            <p>ğŸ“Œ <strong>Official definition:</strong> "An object at rest stays at rest, and an object in motion stays in motion at the same speed and direction â€” unless acted upon by an unbalanced external force."</p>
            <br>
            <p>ğŸš— <strong>Real life example:</strong> When a bus suddenly stops, you lurch forward. Your body wanted to keep moving!</p>
          </div>
          <div class="msg-timestamp">10:31 AM</div>
        </div>
      </div>
      
      <!-- User -->
      <div class="message-row user">
        <div class="msg-avatar" style="background:linear-gradient(135deg,#34d399,#06b6d4);color:white">AS</div>
        <div>
          <div class="chat-bubble user">What is inertia exactly?</div>
          <div class="msg-timestamp">10:33 AM</div>
        </div>
      </div>
      
      <!-- AI response -->
      <div class="message-row">
        <div class="msg-avatar" style="background:linear-gradient(135deg,var(--primary),var(--accent2));color:white">AI</div>
        <div>
          <div class="chat-bubble ai">
            <p><strong>Inertia</strong> is the tendency of an object to resist any change in its state of motion. ğŸ¯</p>
            <br>
            <p>The key thing to know: <strong>heavier objects have more inertia.</strong></p>
            <br>
            <p>Example: It's easier to push a bicycle than a truck, right? The truck resists the push more â€” that's greater inertia! ğŸš› vs ğŸš²</p>
            <br>
            <div style="background:rgba(79,70,229,0.08);padding:10px;border-radius:8px;border-left:3px solid var(--primary)">
              <strong>Key formula:</strong> Inertia âˆ Mass<br>
              More mass = More inertia = Harder to move or stop
            </div>
          </div>
          <div class="msg-timestamp">10:33 AM</div>
        </div>
      </div>
      
      <!-- Typing indicator placeholder -->
      <div id="typing-row" style="display:none" class="message-row">
        <div class="msg-avatar" style="background:linear-gradient(135deg,var(--primary),var(--accent2));color:white">AI</div>
        <div>
          <div class="chat-bubble ai" style="padding:14px 18px">
            <div class="typing-indicator">
              <div class="typing-dots">
                <span></span><span></span><span></span>
              </div>
              <span>Vidya is thinking...</span>
            </div>
          </div>
        </div>
      </div>
      
    </div>
    
    <!-- Suggested chips -->
    <div class="suggested-chips" id="suggested-chips">
      <span class="chip" onclick="sendChip(this)">ğŸ“ Give me a formula sheet</span>
      <span class="chip" onclick="sendChip(this)">ğŸ“ Create practice questions</span>
      <span class="chip" onclick="sendChip(this)">ğŸ“– Explain Newton's 2nd Law</span>
      <span class="chip" onclick="sendChip(this)">ğŸ§ª Real-life examples</span>
    </div>
    
    <!-- Input -->
    <div class="chat-input-area">
      <div style="font-size:0.72rem;color:var(--text-light);margin-bottom:8px;display:flex;align-items:center;gap:6px">
        <span style="width:6px;height:6px;border-radius:50%;background:var(--success);display:inline-block"></span>
        Textbook context loaded Â· Class 10 Physics
      </div>
      <div class="chat-input-box">
        <textarea id="chat-textarea" rows="1" placeholder="Ask anything about Physics..." onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
        <button class="send-btn" onclick="sendMessage()" id="send-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
        </button>
      </div>
      <div style="display:flex;justify-content:space-between;margin-top:8px">
        <div style="display:flex;gap:8px">
          <button class="icon-btn" onclick="showToast('Voice input coming soon','info')" style="width:30px;height:30px;border-radius:8px;font-size:0.85rem">ğŸ¤</button>
          <button class="icon-btn" onclick="showToast('Image upload coming soon','info')" style="width:30px;height:30px;border-radius:8px;font-size:0.85rem">ğŸ“·</button>
        </div>
        <span style="font-size:0.68rem;color:var(--text-light)">Press Enter to send Â· Shift+Enter for new line</span>
      </div>
    </div>
  </div>
</div>

<script src="js/app.js"></script>
<script>
const aiResponses = [
  "Great question! Let me explain this step by step. ğŸ“š\n\nThis concept is fundamental to understanding the bigger picture. The key idea is that forces cause changes in motion, not motion itself.\n\nRemember: <strong>F = ma</strong> is your best friend here! ğŸ’¡",
  "Excellent thinking! ğŸŒŸ Here's what you need to know:\n\n1. The basic principle is straightforward\n2. Apply it to solve problems\n3. Always check units!\n\nWould you like a practice problem to test your understanding?",
  "I found this in your textbook! ğŸ“–\n\nThe concept you're asking about is explained in <strong>Chapter 9, Page 142</strong>. Let me summarize it clearly for you...\n\nThe main idea is that physics connects to everyday life in beautiful ways!",
  "That's a common confusion â€” let me clear it up! âœ¨\n\nMany students mix these up, but once you see the difference, it becomes obvious. Think of it this way: one is a cause, the other is an effect.",
];

let msgCount = 0;

function autoResize(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 120) + 'px';
}

function handleKey(e) {
  if(e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
}

async function sendMessage() {
  const ta = document.getElementById('chat-textarea');
  const text = ta.value.trim();
  if(!text) return;
  
  appendMessage(text, 'user');
  ta.value = '';
  ta.style.height = 'auto';
  
  document.getElementById('suggested-chips').style.display = 'none';
  document.getElementById('send-btn').disabled = true;
  
  // Show typing
  const typingRow = document.getElementById('typing-row');
  typingRow.style.display = 'flex';
  scrollToBottom();
  
  await new Promise(r => setTimeout(r, 1200 + Math.random()*800));
  
  typingRow.style.display = 'none';
  const response = aiResponses[msgCount % aiResponses.length];
  msgCount++;
  
  appendAIMessage(response);
  document.getElementById('send-btn').disabled = false;
  scrollToBottom();
}

function appendMessage(text, type) {
  const area = document.getElementById('messages-area');
  const time = new Date().toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'});
  const div = document.createElement('div');
  div.className = `message-row ${type}`;
  if(type === 'user') {
    div.innerHTML = `
      <div class="msg-avatar" style="background:linear-gradient(135deg,#34d399,#06b6d4);color:white">AS</div>
      <div>
        <div class="chat-bubble user">${text}</div>
        <div class="msg-timestamp">${time}</div>
      </div>`;
  }
  area.insertBefore(div, document.getElementById('typing-row'));
  scrollToBottom();
}

function appendAIMessage(html) {
  const area = document.getElementById('messages-area');
  const time = new Date().toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'});
  const div = document.createElement('div');
  div.className = 'message-row';
  div.innerHTML = `
    <div class="msg-avatar" style="background:linear-gradient(135deg,var(--primary),var(--accent2));color:white">AI</div>
    <div>
      <div class="chat-bubble ai">${html.replace(/\n/g,'<br>')}</div>
      <div class="msg-timestamp">${time}</div>
    </div>`;
  area.insertBefore(div, document.getElementById('typing-row'));
}

function scrollToBottom() {
  const area = document.getElementById('messages-area');
  area.scrollTop = area.scrollHeight;
}

function sendChip(el) {
  document.getElementById('chat-textarea').value = el.textContent.trim().replace(/^[^\s]+ /,'');
  sendMessage();
}

function newChat() {
  document.querySelectorAll('.history-item').forEach(i => i.classList.remove('active'));
  showToast('New conversation started','success');
}

function loadChat(el, title) {
  document.querySelectorAll('.history-item').forEach(i => i.classList.remove('active'));
  el.classList.add('active');
  showToast(`Loaded: ${title}`,'info');
}
</script>
</body>
</html>